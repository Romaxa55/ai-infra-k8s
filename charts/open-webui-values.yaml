# Open WebUI —Å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º –∫ Standalone Ollama
# –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è AI Infrastructure –Ω–∞ Kubernetes
# –ú–ê–ö–°–ò–ú–ê–õ–¨–ù–ê–Ø –ú–û–©–ù–û–°–¢–¨: 96GB RAM + 40 CPU cores

# ==============================================
# OLLAMA –ò–ù–¢–ï–ì–†–ê–¶–ò–Ø - –û–¢–ö–õ–Æ–ß–ê–ï–ú EMBEDDED!
# ==============================================
ollama:
  enabled: false  # –û–¢–ö–õ–Æ–ß–ê–ï–ú –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π Ollama, –∏—Å–ø–æ–ª—å–∑—É–µ–º standalone!

  # GPU –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è - –ü–†–ê–í–ò–õ–¨–ù–´–ô –§–û–†–ú–ê–¢!
  gpu:
    enabled: true
    type: 'nvidia'
    number: 1

  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –º–æ–¥–µ–ª–∏
  models: {}

  # Runtime class - –í–ù–£–¢–†–ò ollama —Å–µ–∫—Ü–∏–∏!
  runtimeClassName: nvidia

  # –†–µ—Å—É—Ä—Å—ã - –Ω–æ—Ä–º–∞–ª—å–Ω—ã–µ
  resources:
    requests:
      memory: "8Gi"
      cpu: "4000m"
    limits:
      memory: "80Gi"
      cpu: "35000m"

  # Storage - –£–í–ï–õ–ò–ß–ò–í–ê–ï–ú –î–û 400GB –î–õ–Ø –ë–û–õ–¨–®–ò–• –ú–û–î–ï–õ–ï–ô!
  persistentVolume:
    enabled: true
    storageClass: "longhorn-ssd"
    size: 400Gi
    accessModes:
      - ReadWriteOnce

# ==============================================
# PIPELINES - AI –†–ê–°–®–ò–†–ï–ù–ò–Ø (–û–¢–ö–õ–Æ–ß–ï–ù–û –í–†–ï–ú–ï–ù–ù–û)
# ==============================================
pipelines:
  enabled: false

# ==============================================
# REDIS - –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨
# ==============================================
redis:
  enabled: true

  # Redis —Ä–µ—Å—É—Ä—Å—ã - –º–∞–∫—Å–∏–º—É–º –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è!
  resources:
    requests:
      memory: "1Gi"
      cpu: "500m"
    limits:
      memory: "8Gi"     # 8GB –¥–ª—è Redis –∫—ç—à–∞
      cpu: "2000m"      # 2 CPU cores

  # Redis Node Placement - –¢–û–õ–¨–ö–û –°–ï–õ–ï–ö–¢–û–†!
  nodeSelector:
    node: pve

# ==============================================
# OPEN WEBUI –û–°–ù–û–í–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò
# ==============================================
# –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è Open WebUI
image:
  repository: ghcr.io/open-webui/open-webui
  tag: "v0.6.12"  # –ü–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è
  pullPolicy: "IfNotPresent"

# ‚ö° Open WebUI Resources - –ú–ê–ö–°–ò–ú–£–ú!
resources:
  requests:
    memory: "4Gi"
    cpu: "2000m"
  limits:
    memory: "16Gi"  # 16GB –¥–ª—è Open WebUI
    cpu: "8000m"    # 8 CPU cores

# üè† Node Placement - –¢–û–õ–¨–ö–û –°–ï–õ–ï–ö–¢–û–†!
nodeSelector:
  node: pve

# üíæ Open WebUI Storage - —É–º–µ–Ω—å—à–∞–µ–º –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞!
persistence:
  enabled: true
  size: 50Gi  # 50GB –¥–ª—è —Ñ–∞–π–ª–æ–≤, —á–∞—Ç–æ–≤, embeddings
  storageClass: "longhorn-ssd"
  accessModes:
    - ReadWriteOnce

# ==============================================
# –°–ï–†–í–ò–° –ò –°–ï–¢–¨
# ==============================================
service:
  type: ClusterIP
  port: 80
  containerPort: 8080

# ==============================================
# AI –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø
# ==============================================
# OpenAI API –≤–∫–ª—é—á–µ–Ω
enableOpenaiApi: true

# üîß Environment Variables –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
extraEnvVars:
  # –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
  - name: OPENAI_API_KEY
    value: "0p3n-w3bu!"

  # WEBUI Secret Key - –ò–°–ü–†–ê–í–õ–Ø–ï–ú –û–®–ò–ë–ö–£!
  - name: WEBUI_SECRET_KEY
    value: "ai-infra-super-secret-key-96gb-ram-monster"

  # USER_AGENT - —É–±–∏—Ä–∞–µ–º warning!
  - name: USER_AGENT
    value: "AI-Infra-OpenWebUI/v0.6.12"

  # OLLAMA DEBUG - –≤–∏–¥–∏–º —á—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å –º–æ–¥–µ–ª—è–º–∏!
  - name: OLLAMA_DEBUG
    value: "1"

  # –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –ö STANDALONE OLLAMA!
  - name: OLLAMA_BASE_URL
    value: "http://ollama-standalone:11434"
  - name: ENABLE_OLLAMA_API
    value: "True"

  # RAG –∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏
  - name: RAG_EMBEDDING_ENGINE
    value: "ollama"
  - name: RAG_EMBEDDING_MODEL
    value: "nomic-embed-text"

  # –§–∞–π–ª—ã –∏ –∑–∞–≥—Ä—É–∑–∫–∏ - –ë–û–õ–¨–®–ò–ï –ª–∏–º–∏—Ç—ã!
  - name: ENABLE_RAG_WEB_SEARCH
    value: "true"
  - name: ENABLE_RAG_LOCAL_WEB_FETCH
    value: "true"
  - name: FILE_SIZE_LIMIT
    value: "5000"  # 5GB —Ñ–∞–π–ª—ã!
  - name: MAX_FILE_SIZE
    value: "5368709120"  # 5GB –≤ –±–∞–π—Ç–∞—Ö

  # –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
  - name: ENABLE_SIGNUP
    value: "true"
  - name: DEFAULT_USER_ROLE
    value: "user"

  # –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å WebSocket
  - name: ENABLE_WEBSOCKET_SUPPORT
    value: "true"
  - name: WEBSOCKET_MANAGER
    value: "redis"
  - name: WEBSOCKET_REDIS_URL
    value: "redis://open-webui-redis:6379/0"

  # –†–∞–∑—Ä–µ—à–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
  - name: USER_PERMISSIONS_CHAT_DELETION
    value: "true"
  - name: USER_PERMISSIONS_CHAT_EDITING
    value: "true"
  - name: USER_PERMISSIONS_CHAT_TEMPORARY
    value: "true"

  # –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–ª—è –±–æ–ª—å—à–∏—Ö –º–æ–¥–µ–ª–µ–π
  - name: OLLAMA_REQUEST_TIMEOUT
    value: "600"  # 10 –º–∏–Ω—É—Ç —Ç–∞–π–º–∞—É—Ç
  - name: OLLAMA_KEEP_ALIVE
    value: "24h"  # –î–µ—Ä–∂–∏–º –º–æ–¥–µ–ª–∏ –≤ –ø–∞–º—è—Ç–∏ 24 —á–∞—Å–∞

# ==============================================
# –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ - –ò–°–ü–†–ê–í–õ–ï–ù–û –î–õ–Ø STATIC –§–ê–ô–õ–û–í!
# ==============================================
podSecurityContext:
  fsGroup: 0  # root group –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º
  runAsNonRoot: false  # —Ä–∞–∑—Ä–µ—à–∞–µ–º root
  runAsUser: 0  # –∑–∞–ø—É—Å–∫–∞–µ–º –∫–∞–∫ root

containerSecurityContext:
  runAsNonRoot: false  # —Ä–∞–∑—Ä–µ—à–∞–µ–º root
  runAsUser: 0  # –∑–∞–ø—É—Å–∫–∞–µ–º –∫–∞–∫ root
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: false  # –†–∞–∑—Ä–µ—à–∞–µ–º –∑–∞–ø–∏—Å—å –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ!
  capabilities:
    drop:
      - ALL

# ==============================================
# –ú–û–ù–ò–¢–û–†–ò–ù–ì –ò –ü–†–û–í–ï–†–ö–ò
# ==============================================
livenessProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 180
  periodSeconds: 60
  failureThreshold: 5

readinessProbe:
  httpGet:
    path: /health/db
    port: http
  initialDelaySeconds: 120
  periodSeconds: 30
  failureThreshold: 10

startupProbe:
  httpGet:
    path: /health
    port: http
  initialDelaySeconds: 60
  periodSeconds: 15
  failureThreshold: 40

# ==============================================
# –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –°–ï–†–í–ò–°–´ (–û–¢–ö–õ–Æ–ß–ï–ù–´)
# ==============================================
tika:
  enabled: false

# ==============================================
# –ë–ê–ó–ê –î–ê–ù–ù–´–• - POSTGRESQL!
# ==============================================
# Configure database URL –¥–ª—è PostgreSQL
databaseUrl: "postgresql://open-webui:0p3n-w3bu!@open-webui-postgres:5432/open-webui"

# Postgresql configuration  
postgresql:
  enabled: true  # –í–ö–õ–Æ–ß–ê–ï–ú PostgreSQL!
  fullnameOverride: open-webui-postgres
  architecture: standalone
  auth:
    database: open-webui
    postgresPassword: 0p3n-w3bu!
    username: open-webui
    password: 0p3n-w3bu!
  primary:
    persistence:
      size: 10Gi  # 10GB –¥–ª—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
      storageClass: "longhorn-ssd"
    resources:
      requests:
        memory: "1Gi"
        cpu: "500m"
      limits:
        memory: "4Gi"  # 4GB –¥–ª—è PostgreSQL
        cpu: "2000m"   # 2 CPU cores
    
    # Node placement
    nodeSelector:
      node: pve

# Configure Application logging levels 
logging:
  level: "info"  # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –¥–µ–±–∞–≥–≥–∏–Ω–≥–∞
